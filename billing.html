<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <title>BAU-Ops Tools</title>
</head>
<body>

<div>
  <ul>
    <li><a href="cease.html">Cease Billing Format</a></li>
    <li><a href="port.html">Billing Format</a></li>
    <li><a href="ipms.html">IPMS Format</a></li>
    <li><a href="devoli.html">Devoli Format</a></li>
    <li><a href="list.html">List for BAU Ops</a></li>
    <li><a href="range.html">Extract Range Format</a></li>
    <li><a href="number range.html">Group Range Format</a></li>
    <li><a href="lsp.html">LSP Notification</a></li>
    <li><a href="enable.html">Enable Orders on Hold</a></li>
    <li><a href="toll-free.html">Toll-Free Explanation</a></li>
    <li><a href="billing.html"><b>Convert to Billing Format</b></a></li>
    <li><a href="tf.html">Toll-Free for Billing</a></li>
  </ul>
</div>

<h1>Convert to Billing Format by Bernie</h1>

<div>
  <textarea id="inputNumbers" rows="8" cols="50" onfocus="this.value=''; return false;"></textarea>
  <p>
    <button id="btnProcess">Format</button>
  </p>

  <h2>Numbers for Billing 0xxxxxxx to 0x xxxxxx</h2>
  <pre id="output"></pre>
  <div id="message"></div>
</div>

<script>
(function () {
  const MAX_EXPAND = 10000; // safety cap

  document.getElementById('btnProcess').addEventListener('click', processNumbers);

  function copyToClipboard(text) {
    if (!text) return;

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text).catch(() => {});
    } else {
      // Fallback for older browsers
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } catch (e) {}
      document.body.removeChild(ta);
    }
  }

  function processNumbers() {
    const raw = document.getElementById('inputNumbers').value || '';
    const tokens = tokenize(raw);
    const out = [];
    const errors = [];

    for (const token of tokens) {
      try {
        const t = token.replace(/\s+/g, '');
        if (!t) continue;

        if (!t.includes('-')) {
          const d = normalizeDigits(t);
          if (!d) { errors.push(`ignored: "${token}"`); continue; }
          out.push(formatWithSpace(d));
          continue;
        }

        const parts = t.split('-');
        if (parts.length !== 2) { errors.push(`invalid range: "${token}"`); continue; }

        const startDigits = normalizeDigits(parts[0]);
        if (!startDigits) { errors.push(`invalid start in "${token}"`); continue; }

        const endDigitsCandidate = normalizeDigits(parts[1]);
        if (!endDigitsCandidate) { errors.push(`invalid end in "${token}"`); continue; }

        let fullEndDigits;
        if (endDigitsCandidate.length < startDigits.length) {
          const base = startDigits.slice(0, startDigits.length - endDigitsCandidate.length);
          fullEndDigits = base + endDigitsCandidate;
        } else {
          fullEndDigits = endDigitsCandidate;
        }

        const startNum = Number(startDigits);
        const endNum = Number(fullEndDigits);

        if (endNum < startNum) { errors.push(`end < start in "${token}"`); continue; }

        const count = endNum - startNum + 1;
        if (count > MAX_EXPAND) {
          errors.push(`range too large in "${token}" (${count} items)`);
          continue;
        }

        for (let n = startNum; n <= endNum; n++) {
          out.push(formatWithSpace(String(n)));
        }
      } catch (err) {
        errors.push(`error with "${token}": ${err.message}`);
      }
    }

    const unique = [];
    const seen = new Set();
    for (const s of out) {
      if (!seen.has(s)) {
        seen.add(s);
        unique.push(s);
      }
    }

    const resultText = unique.join('\n');

    document.getElementById('output').textContent = resultText || '(no results)';
    document.getElementById('message').textContent = errors.length ? errors.join('\n') : '';

    // âœ… Silent auto-copy
    if (resultText) {
      copyToClipboard(resultText);
    }
  }

  function tokenize(raw) {
    if (!raw) return [];
    return raw
      .split(/[,\n;]+/)
      .map(t => t.trim())
      .filter(Boolean);
  }

  function normalizeDigits(str) {
    const digits = String(str).replace(/\D/g, '');
    if (!digits) return '';
    if (digits.startsWith('64')) return '0' + digits.slice(2);
    return digits;
  }

  function formatWithSpace(digits) {
    let s = String(digits);
    if (!s.startsWith('0')) s = '0' + s;
    return `${s.slice(0, 2)} ${s.slice(2)}`;
  }
})();
</script>

</body>
</html>


